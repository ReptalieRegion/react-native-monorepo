# .circleci/config.yml
version: 2.1

orbs:
    node: circleci/node@5.2.0

jobs:
    yarn-install:
        docker:
            - image: cimg/base:stable
        steps:
            - checkout
            - node/install:
                  install-yarn: true
                  node-version: '18.18.2'
            - run:
                  name: yarn install
                  command: |
                      yarn install
    build-and-test:
        macos:
            xcode: 14.2.0
        environment:
            FL_OUTPUT_DIR: output
        steps:
            - run: ls
            - run: cd apps/crawl
            - run:
                  name: bundle install
                  command: bundle install
            - run:
                  name: Fastlane
                  command: cd ios && bundle exec fastlane development 1.1.23
            - store_artifacts:
                  path: output

workflows:
    build-test-adhoc:
        jobs:
            - yarn-install
            - build-and-test:
                  requires:
                      - yarn-install
